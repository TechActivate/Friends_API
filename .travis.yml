sudo: required
services:
  - docker

before_install:
  - docker pull openjdk:11-jdk
  - docker pull maven:3-jdk-11
  - docker login -u="$DOCKER_USERNAME" -p="$DOCKER_PASSWORD"

install:
  - docker build -t techactivate/friendsapi .

script:
  - docker images
  - docker tag techactivate/friendsapi techactivate/friendsapi:$(git rev-parse HEAD)
  - docker push  techactivate/friendsapi:$(git rev-parse HEAD)
#    branch: master


after_success:
  - sudo docker login --username $HEROKU_DOCKER_USERNAME --password $HEROKU_AUTH_TOKEN registry.heroku.com
  - sudo docker tag friendsapi:latest registry.heroku.com/friendsapi-mahajany/web
  - if [ $TRAVIS_BRANCH == "master" ] && [ $TRAVIS_PULL_REQUEST = "false" ]; then sudo docker push registry.heroku.com/friendsapi-mahajany/web; fi
